<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baby Gender Guess ðŸ¼</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --blue: #7BAFD4; --blue-light: #B8D8EE; --blue-dark: #4A86B8;
    --pink: #E8879C; --pink-light: #F5C4CF; --pink-dark: #C9566D;
    --cream: #FDF8F4; --text: #3A3035;
  }
  body {
    min-height: 100vh;
    background-color: var(--cream);
    background-image:
      radial-gradient(circle at 15% 20%, rgba(184,216,238,0.35) 0%, transparent 40%),
      radial-gradient(circle at 85% 80%, rgba(245,196,207,0.35) 0%, transparent 40%);
    font-family: 'Lato', sans-serif;
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    min-height: 100vh;
  }
  .card {
    background: white;
    border-radius: 2rem;
    padding: 3rem 3.5rem;
    max-width: 520px;
    width: 100%;
    box-shadow: 0 8px 48px rgba(0,0,0,0.07), 0 2px 12px rgba(0,0,0,0.04);
    text-align: center;
  }
  .screen { animation: rise 0.5s cubic-bezier(0.22,1,0.36,1) both; }
  @keyframes rise { from { opacity:0; transform:translateY(20px); } to { opacity:1; transform:translateY(0); } }

  .emoji { font-size: 3rem; margin-bottom: 1rem; display: block; }
  h1 { font-family: 'Playfair Display', serif; font-size: 2.1rem; font-weight: 700; line-height: 1.2; margin-bottom: 0.4rem; }
  .subtitle { font-size: 1rem; font-weight: 300; color: #888; margin-bottom: 2rem; letter-spacing: 0.02em; }

  /* Name input */
  .name-input {
    width: 100%;
    border: 2px solid #EDE9E4;
    border-radius: 0.875rem;
    padding: 0.9rem 1.2rem;
    font-family: 'Lato', sans-serif;
    font-size: 1.1rem;
    font-weight: 400;
    color: var(--text);
    outline: none;
    transition: border-color 0.2s ease;
    margin-bottom: 1rem;
    text-align: center;
  }
  .name-input:focus { border-color: #B8D8EE; }
  .name-input::placeholder { color: #C8C4BE; }

  .btn-continue {
    width: 100%;
    border: none;
    border-radius: 0.875rem;
    padding: 0.9rem 1.2rem;
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    background: linear-gradient(145deg, #B8D8EE, #7BAFD4);
    color: white;
    box-shadow: 0 4px 16px rgba(75,134,184,0.3);
    transition: transform 0.15s ease, box-shadow 0.15s ease, opacity 0.15s ease;
  }
  .btn-continue:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(74,134,184,0.4); }
  .btn-continue:disabled { opacity: 0.4; cursor: default; transform: none; }

  /* Vote buttons */
  .choices { display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 2rem; }
  .btn {
    border: none; border-radius: 1.25rem; padding: 1.8rem 1rem;
    font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 700;
    cursor: pointer;
    display: flex; flex-direction: column; align-items: center; gap: 0.5rem;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    color: white;
  }
  .btn:hover:not(:disabled) { transform: translateY(-4px); }
  .btn:active:not(:disabled) { transform: translateY(0); }
  .btn:disabled { cursor: default; transform: none; }
  .btn .btn-emoji { font-size: 2.2rem; }
  .btn-boy  { background: linear-gradient(145deg, var(--blue-light),  var(--blue));  box-shadow: 0 6px 24px rgba(75,134,184,0.3); }
  .btn-boy:hover:not(:disabled)  { box-shadow: 0 12px 36px rgba(74,134,184,0.45); }
  .btn-girl { background: linear-gradient(145deg, var(--pink-light), var(--pink)); box-shadow: 0 6px 24px rgba(201,86,109,0.25); }
  .btn-girl:hover:not(:disabled) { box-shadow: 0 12px 36px rgba(201,86,109,0.38); }

  /* Results */
  .voted-badge {
    display: inline-block; background: #f4f1ee; border-radius: 99px;
    padding: 0.35rem 1rem; font-size: 0.8rem; color: #999;
    margin-bottom: 1.5rem; letter-spacing: 0.04em;
  }
  .result-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
  .result-label { font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 700; width: 48px; text-align: right; flex-shrink: 0; }
  .bar-wrap { flex: 1; background: #F0EDE9; border-radius: 99px; height: 14px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 99px; transition: width 1s cubic-bezier(0.22,1,0.36,1); width: 0%; }
  .bar-boy  { background: linear-gradient(90deg, var(--blue-light), var(--blue)); }
  .bar-girl { background: linear-gradient(90deg, var(--pink-light), var(--pink)); }
  .result-pct { font-weight: 700; font-size: 0.95rem; width: 40px; text-align: left; flex-shrink: 0; }
  .tally-note { font-size: 0.82rem; font-weight: 300; color: #aaa; margin-top: 0.5rem; margin-bottom: 1.75rem; }

  /* Ballot feed */
  .feed-title {
    font-family: 'Playfair Display', serif;
    font-size: 0.95rem;
    font-weight: 700;
    color: #B0A9A2;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.75rem;
    text-align: left;
  }
  .feed {
    max-height: 200px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    padding-right: 4px;
  }
  .feed::-webkit-scrollbar { width: 4px; }
  .feed::-webkit-scrollbar-track { background: #F0EDE9; border-radius: 99px; }
  .feed::-webkit-scrollbar-thumb { background: #D4CEC8; border-radius: 99px; }

  .feed-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.55rem 0.85rem;
    border-radius: 0.625rem;
    background: #FAF8F5;
    animation: rise 0.4s cubic-bezier(0.22,1,0.36,1) both;
  }
  .feed-name {
    font-family: 'Lato', sans-serif;
    font-weight: 700;
    font-size: 0.9rem;
    color: var(--text);
  }
  .feed-choice {
    font-family: 'Lato', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    border-radius: 99px;
    padding: 0.2rem 0.7rem;
    letter-spacing: 0.04em;
  }
  .feed-choice.boy  { background: #EBF4FB; color: var(--blue-dark); }
  .feed-choice.girl { background: #FCEEF1; color: var(--pink-dark); }
  .feed-time {
    font-family: 'Lato', sans-serif;
    font-size: 0.72rem;
    color: #C0B8B0;
    min-width: 52px;
    text-align: right;
  }
</style>
</head>
<body>
<div class="card" id="card">

  <!-- SCREEN 1: Name entry -->
  <div id="screen-name" class="screen">
    <span class="emoji">ðŸ¼</span>
    <h1>Boy or Girl?</h1>
    <p class="subtitle">What's your name?</p>
    <input
      class="name-input"
      id="name-input"
      type="text"
      placeholder="Enter your nameâ€¦"
      maxlength="40"
      autocomplete="off"
      oninput="onNameInput()"
      onkeydown="if(event.key==='Enter') submitName()"
    />
    <button class="btn-continue" id="btn-continue" onclick="submitName()" disabled>
      Continue â†’
    </button>
  </div>

  <!-- SCREEN 2: Vote -->
  <div id="screen-vote" class="screen" style="display:none;">
    <span class="emoji">ðŸ¼</span>
    <h1>Boy or Girl?</h1>
    <p class="subtitle" id="vote-subtitle">Cast your vote!</p>
    <div class="choices">
      <button class="btn btn-boy" onclick="vote('boy')">
        <span class="btn-emoji">ðŸ‘¦</span> Boy
      </button>
      <button class="btn btn-girl" onclick="vote('girl')">
        <span class="btn-emoji">ðŸ‘§</span> Girl
      </button>
    </div>
  </div>

  <!-- SCREEN 3: Results -->
  <div id="screen-results" class="screen" style="display:none;">
    <span class="emoji">ðŸ¼</span>
    <h1>Boy or Girl?</h1>

    <div class="voted-badge" id="voted-badge"></div>

    <div class="result-row">
      <span class="result-label" style="color:var(--blue-dark)">Boy</span>
      <div class="bar-wrap"><div class="bar-fill bar-boy" id="bar-boy"></div></div>
      <span class="result-pct" id="pct-boy">0%</span>
    </div>
    <div class="result-row">
      <span class="result-label" style="color:var(--pink-dark)">Girl</span>
      <div class="bar-wrap"><div class="bar-fill bar-girl" id="bar-girl"></div></div>
      <span class="result-pct" id="pct-girl">0%</span>
    </div>
    <p class="tally-note" id="tally-note"></p>

    <div class="feed-title">Who voted for what</div>
    <div class="feed" id="feed"></div>
  </div>

</div>

<script>
  const SUPABASE_URL = "https://rzounkywhxriavkswotm.supabase.co";
  const SUPABASE_KEY = "sb_publishable_GGNfWZXJafHbroc8uPN0_Q_ZlXt8KQo";
  const VOTED_KEY    = "baby-gender-my-vote-v2";
  const NAME_KEY     = "baby-gender-my-name-v2";

  const headers = {
    "apikey": SUPABASE_KEY,
    "Authorization": `Bearer ${SUPABASE_KEY}`,
    "Content-Type": "application/json"
  };

  // â”€â”€ API helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function fetchVotes() {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/votes?id=eq.main&select=boy,girl`, { headers });
    const d = await res.json();
    return d[0] || { boy: 0, girl: 0 };
  }

  async function incrementVote(choice) {
    const current = await fetchVotes();
    const newVal  = current[choice] + 1;
    await fetch(`${SUPABASE_URL}/rest/v1/votes?id=eq.main`, {
      method: "PATCH",
      headers: { ...headers, "Prefer": "return=minimal" },
      body: JSON.stringify({ [choice]: newVal })
    });
    return { ...current, [choice]: newVal };
  }

  async function insertBallot(name, choice) {
    await fetch(`${SUPABASE_URL}/rest/v1/ballots`, {
      method: "POST",
      headers: { ...headers, "Prefer": "return=minimal" },
      body: JSON.stringify({ name, choice })
    });
  }

  async function fetchBallots() {
    const res = await fetch(
      `${SUPABASE_URL}/rest/v1/ballots?select=name,choice,created_at&order=created_at.asc`,
      { headers }
    );
    return res.json();
  }

  // â”€â”€ UI helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function showScreen(id) {
    ['screen-name','screen-vote','screen-results'].forEach(s => {
      const el = document.getElementById(s);
      el.style.display = s === id ? 'block' : 'none';
      if (s === id) el.classList.add('screen'); // re-trigger animation
    });
  }

  function timeAgo(isoStr) {
    const diff = Math.floor((Date.now() - new Date(isoStr)) / 1000);
    if (diff < 60)   return 'just now';
    if (diff < 3600) return Math.floor(diff/60) + 'm ago';
    if (diff < 86400)return Math.floor(diff/3600) + 'h ago';
    return Math.floor(diff/86400) + 'd ago';
  }

  function renderFeed(ballots) {
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    [...ballots].reverse().forEach(b => {
      const item = document.createElement('div');
      item.className = 'feed-item';
      item.innerHTML = `
        <span class="feed-name">${escHtml(b.name)}</span>
        <span class="feed-choice ${b.choice}">${b.choice === 'boy' ? 'ðŸ‘¦ Boy' : 'ðŸ‘§ Girl'}</span>
        <span class="feed-time">${timeAgo(b.created_at)}</span>
      `;
      feed.appendChild(item);
    });
  }

  function escHtml(str) {
    return str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function showResults(choice, votes, ballots) {
    showScreen('screen-results');
    const total   = votes.boy + votes.girl;
    const boyPct  = total ? Math.round((votes.boy  / total) * 100) : 0;
    const girlPct = total ? 100 - boyPct : 0;

    document.getElementById('voted-badge').textContent =
      `You voted: ${choice === 'boy' ? 'Boy' : 'Girl'} âœ“`;
    document.getElementById('pct-boy').textContent   = boyPct  + '%';
    document.getElementById('pct-girl').textContent  = girlPct + '%';
    document.getElementById('tally-note').textContent =
      `${total} vote${total === 1 ? '' : 's'} total`;

    setTimeout(() => {
      document.getElementById('bar-boy').style.width  = boyPct  + '%';
      document.getElementById('bar-girl').style.width = girlPct + '%';
    }, 100);

    renderFeed(ballots);
  }

  // â”€â”€ Name screen â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function onNameInput() {
    const val = document.getElementById('name-input').value.trim();
    document.getElementById('btn-continue').disabled = val.length === 0;
  }

  function submitName() {
    const name = document.getElementById('name-input').value.trim();
    if (!name) return;
    localStorage.setItem(NAME_KEY, name);

    const prior = localStorage.getItem(VOTED_KEY);
    if (prior) {
      // Already voted â€” skip straight to results
      loadAndShowResults(prior);
    } else {
      document.getElementById('vote-subtitle').textContent =
        `What do you think, ${name}?`;
      showScreen('screen-vote');
    }
  }

  // â”€â”€ Vote â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function vote(choice) {
    if (localStorage.getItem(VOTED_KEY)) return;
    const name = localStorage.getItem(NAME_KEY) || 'Anonymous';

    document.querySelectorAll('.btn').forEach(b => b.disabled = true);
    localStorage.setItem(VOTED_KEY, choice);

    try {
      const [votes] = await Promise.all([
        incrementVote(choice),
        insertBallot(name, choice)
      ]);
      const ballots = await fetchBallots();
      showResults(choice, votes, ballots);
    } catch(e) {
      console.error(e);
      const [votes, ballots] = await Promise.all([fetchVotes(), fetchBallots()]);
      showResults(choice, votes, ballots);
    }
  }

  async function loadAndShowResults(choice) {
    const [votes, ballots] = await Promise.all([fetchVotes(), fetchBallots()]);
    showResults(choice, votes, ballots);
  }

  // â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  window.addEventListener('DOMContentLoaded', () => {
    // Always start at name screen â€” name pre-fills if known
    const savedName = localStorage.getItem(NAME_KEY);
    if (savedName) {
      document.getElementById('name-input').value = savedName;
      document.getElementById('btn-continue').disabled = false;
    }
    showScreen('screen-name');
    document.getElementById('name-input').focus();
  });
</script>
</body>
</html>
