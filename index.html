<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Baby Gender Guess üçº</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  :root {
    --blue: #7BAFD4; --blue-light: #B8D8EE; --blue-dark: #4A86B8;
    --pink: #E8879C; --pink-light: #F5C4CF; --pink-dark: #C9566D;
    --cream: #FDF8F4; --text: #3A3035;
  }
  body {
    min-height: 100vh;
    background-color: var(--cream);
    background-image:
      radial-gradient(circle at 15% 20%, rgba(184,216,238,0.35) 0%, transparent 40%),
      radial-gradient(circle at 85% 80%, rgba(245,196,207,0.35) 0%, transparent 40%);
    font-family: 'Lato', sans-serif;
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
  }
  .card {
    background: white;
    border-radius: 2rem;
    padding: 3rem 3.5rem;
    max-width: 520px;
    width: 100%;
    box-shadow: 0 8px 48px rgba(0,0,0,0.07), 0 2px 12px rgba(0,0,0,0.04);
    text-align: center;
    animation: rise 0.7s cubic-bezier(0.22,1,0.36,1) both;
  }
  @keyframes rise { from { opacity:0; transform:translateY(28px); } to { opacity:1; transform:translateY(0); } }
  .emoji { font-size: 3rem; margin-bottom: 1rem; display: block; }
  h1 { font-family: 'Playfair Display', serif; font-size: 2.1rem; font-weight: 700; line-height: 1.2; margin-bottom: 0.4rem; }
  .subtitle { font-size: 1rem; font-weight: 300; color: #888; margin-bottom: 2.5rem; letter-spacing: 0.02em; }
  .choices { display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 2rem; }
  .btn {
    border: none; border-radius: 1.25rem; padding: 1.8rem 1rem;
    font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 700;
    cursor: pointer;
    display: flex; flex-direction: column; align-items: center; gap: 0.5rem;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
    color: white;
  }
  .btn:hover { transform: translateY(-4px); }
  .btn:active { transform: translateY(0); }
  .btn:disabled { cursor: default; transform: none; }
  .btn .btn-emoji { font-size: 2.2rem; }
  .btn-boy { background: linear-gradient(145deg, var(--blue-light), var(--blue)); box-shadow: 0 6px 24px rgba(75,134,184,0.3); }
  .btn-boy:hover { box-shadow: 0 12px 36px rgba(74,134,184,0.45); }
  .btn-girl { background: linear-gradient(145deg, var(--pink-light), var(--pink)); box-shadow: 0 6px 24px rgba(201,86,109,0.25); }
  .btn-girl:hover { box-shadow: 0 12px 36px rgba(201,86,109,0.38); }
  .results { display: none; animation: rise 0.5s cubic-bezier(0.22,1,0.36,1) both; }
  .results.show { display: block; }
  .result-row { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
  .result-label { font-family: 'Playfair Display', serif; font-size: 1rem; font-weight: 700; width: 48px; text-align: right; flex-shrink: 0; }
  .bar-wrap { flex: 1; background: #F0EDE9; border-radius: 99px; height: 14px; overflow: hidden; }
  .bar-fill { height: 100%; border-radius: 99px; transition: width 1s cubic-bezier(0.22,1,0.36,1); width: 0%; }
  .bar-boy  { background: linear-gradient(90deg, var(--blue-light), var(--blue)); }
  .bar-girl { background: linear-gradient(90deg, var(--pink-light), var(--pink)); }
  .result-pct { font-weight: 700; font-size: 0.95rem; width: 40px; text-align: left; flex-shrink: 0; }
  .tally-note { font-size: 0.82rem; font-weight: 300; color: #aaa; margin-top: 0.5rem; }
  .voted-badge {
    display: inline-block; background: #f4f1ee; border-radius: 99px;
    padding: 0.35rem 1rem; font-size: 0.8rem; color: #999;
    margin-bottom: 1.5rem; letter-spacing: 0.04em;
  }
</style>
</head>
<body>
<div class="card">
  <span class="emoji">üçº</span>
  <h1>Boy or Girl?</h1>
  <p class="subtitle">Cast your vote ‚Äî we'll reveal the results soon!</p>
  <div class="choices" id="choices">
    <button class="btn btn-boy" onclick="vote('boy')">
      <span class="btn-emoji">üë¶</span> Boy
    </button>
    <button class="btn btn-girl" onclick="vote('girl')">
      <span class="btn-emoji">üëß</span> Girl
    </button>
  </div>
  <div class="results" id="results">
    <div class="voted-badge" id="voted-badge"></div>
    <div class="result-row">
      <span class="result-label" style="color:var(--blue-dark)">Boy</span>
      <div class="bar-wrap"><div class="bar-fill bar-boy" id="bar-boy"></div></div>
      <span class="result-pct" id="pct-boy">0%</span>
    </div>
    <div class="result-row">
      <span class="result-label" style="color:var(--pink-dark)">Girl</span>
      <div class="bar-wrap"><div class="bar-fill bar-girl" id="bar-girl"></div></div>
      <span class="result-pct" id="pct-girl">0%</span>
    </div>
    <p class="tally-note" id="tally-note"></p>
  </div>
</div>

<script>
  const SUPABASE_URL = "https://rzounkywhxriavkswotm.supabase.co";
  const SUPABASE_KEY = "sb_publishable_GGNfWZXJafHbroc8uPN0_Q_ZlXt8KQo";
  const VOTED_KEY = "baby-gender-my-vote-v1";

  async function fetchVotes() {
    const res = await fetch(`${SUPABASE_URL}/rest/v1/votes?id=eq.main&select=boy,girl`, {
      headers: { "apikey": SUPABASE_KEY, "Authorization": `Bearer ${SUPABASE_KEY}` }
    });
    const data = await res.json();
    return data[0] || { boy: 0, girl: 0 };
  }

  async function incrementVote(choice) {
    const current = await fetchVotes();
    const newVal = current[choice] + 1;
    await fetch(`${SUPABASE_URL}/rest/v1/votes?id=eq.main`, {
      method: "PATCH",
      headers: {
        "apikey": SUPABASE_KEY,
        "Authorization": `Bearer ${SUPABASE_KEY}`,
        "Content-Type": "application/json",
        "Prefer": "return=minimal"
      },
      body: JSON.stringify({ [choice]: newVal })
    });
    return { ...current, [choice]: newVal };
  }

  async function vote(choice) {
    if (localStorage.getItem(VOTED_KEY)) return;
    localStorage.setItem(VOTED_KEY, choice);
    document.querySelectorAll('.btn').forEach(b => b.disabled = true);
    try {
      const updated = await incrementVote(choice);
      showResults(choice, updated);
    } catch(e) {
      const current = await fetchVotes();
      showResults(choice, current);
    }
  }

  function showResults(choice, votes) {
    const total = votes.boy + votes.girl;
    const boyPct  = total ? Math.round((votes.boy  / total) * 100) : 0;
    const girlPct = total ? 100 - boyPct : 0;

    document.getElementById('voted-badge').textContent =
      `You voted: ${choice.charAt(0).toUpperCase() + choice.slice(1)} ‚úì`;
    document.getElementById('pct-boy').textContent  = boyPct + '%';
    document.getElementById('pct-girl').textContent = girlPct + '%';
    document.getElementById('tally-note').textContent =
      `${total} vote${total === 1 ? '' : 's'} total`;

    document.querySelectorAll('.btn').forEach(b => {
      b.style.opacity = b.classList.contains('btn-' + choice) ? '1' : '0.6';
    });
    document.getElementById('results').classList.add('show');

    setTimeout(() => {
      document.getElementById('bar-boy').style.width  = boyPct + '%';
      document.getElementById('bar-girl').style.width = girlPct + '%';
    }, 100);
  }

  // On load: restore state if already voted
  window.addEventListener('DOMContentLoaded', async () => {
    const prior = localStorage.getItem(VOTED_KEY);
    const votes = await fetchVotes();
    if (prior) {
      document.querySelectorAll('.btn').forEach(b => b.disabled = true);
      showResults(prior, votes);
    }
  });
</script>
</body>
</html>
